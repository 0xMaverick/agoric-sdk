---

- name: Synchronize helper
  synchronize:
    src: "{{HELPER_BINARY}}"
    dest: /usr/bin/
    mode: push

- name: Synchronize install directory
  synchronize:
    src: "{{APPDIR}}/"
    dest: "/usr/src/{{service}}/"
    dirs: yes
    delete: yes
    mode: push
    rsync_opts:
    - "--exclude=.git"
    - "--exclude=setup"
    - "--exclude=.vscode"
    - "--exclude=chains"
    - "--exclude=x"
    - "--exclude=t[0-9]*"
    - "--exclude=provisioning-server"

- name: "Symlink /usr/src/app"
  file:
    src: "/usr/src/{{service}}"
    dest: /usr/src/app
    state: link

- name: "Symlink {{service}}"
  file:
    src: "/usr/src/{{service}}/lib/{{service}}"
    dest: "/usr/local/bin/{{service}}"
    state: link

- name: "Symlink ag-solo"
  file:
    src: "/usr/src/{{service}}/bin/ag-solo"
    dest: "/usr/local/bin/ag-solo"
    state: link
