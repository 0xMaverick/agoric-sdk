---

- name: Ensure public exists
  become_user: "{{ service }}"
  become: yes
  file:
    path: "/home/{{ service }}/public"
    state: directory
    mode: '0755'

- name: Copy network-config
  become_user: "{{ service }}"
  become: yes
  copy:
    src: "{{ SETUP_HOME }}/{{ service }}/data/cosmos-chain.json"
    dest: "/home/{{ service }}/public/network-config"
    mode: '0644'

- name: Copy genesis.json
  become_user: "{{ service }}"
  become: yes
  copy:
    src: "{{ SETUP_HOME }}/ag-chain-cosmos/data/genesis.json"
    dest: "/home/{{ service }}/public/genesis.json"
    mode: '0644'

- name: "Stat CRT"
  delegate_to: localhost
  stat:
    path="{{ SETUP_HOME }}/{{ NETWORK_NAME }}.crt"
  register: stat_crt

- name: "Stat KEY"
  delegate_to: localhost
  stat:
    path="{{ SETUP_HOME }}/{{ NETWORK_NAME }}.key"
  register: stat_key

- name: "Copy {{ NETWORK_NAME }}.crt"
  become_user: "{{ service }}"
  become: yes
  copy:
    src: "{{ SETUP_HOME }}/{{ NETWORK_NAME }}.crt"
    dest: "/home/{{ service }}/{{ NETWORK_NAME }}.crt"
    mode: '0644'
  when: stat_crt.stat.exists

- name: "Copy {{ NETWORK_NAME }}.key"
  become_user: "{{ service }}"
  become: yes
  copy:
    src: "{{ SETUP_HOME }}/{{ NETWORK_NAME }}.key"
    dest: "/home/{{ service }}/{{ NETWORK_NAME }}.key"
    mode: "0600"
  when: stat_key.stat.exists
