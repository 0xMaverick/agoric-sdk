#!/usr/bin/env node

const process = require('process');
const repl = require('repl');
require = require('esm')(module);

const { loadBasedir, buildVatController } = require('../src/index.js');

async function main() {
  const basedir = process.argv[2] || '.';
  const config = await loadBasedir(basedir);
  const controller = await buildVatController(config);
  const r = repl.start({ prompt: 'vat> ',
                         replMode: repl.REPL_MODE_STRICT,
                       });
  r.context.dump = () => console.log(controller.dump());
  r.context.run = () => {console.log('run!'); controller.run();};
  r.context.step = () => {console.log('step!'); controller.step();};

}

main();

